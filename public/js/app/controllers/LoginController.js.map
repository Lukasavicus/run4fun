{"version":3,"sources":["../../app-es6/controllers/LoginController.js"],"names":["loginControllerInstance","loginController","HttpService","LoginController","_service","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","login","passwd","post","method","body","stringify","headers","then","res","get","console","log","window","sessionStorage","_parseJwt","location","href","catch","err"],"mappings":";;;;;;;;;;;;;AAiEO,UAASA,uBAAT,GAAkC;AACrC,SAAOC,eAAP;AACH;;oCAFeD,uB;;;;AAjERE,c,wBAAAA,W;;;;;;;;;;;;;;;;;;;;;AAEFC,kB;AAEL,+BAAa;AAAA;;AACZ,UAAKC,QAAL,GAAgB,IAAIF,WAAJ,EAAhB;AACA;;;;+BAEUG,K,EAAO;AACjB,UAAIC,YAAYD,MAAME,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAhB;AACA,UAAIC,SAASF,UAAUG,OAAV,CAAkB,IAAlB,EAAwB,GAAxB,EAA6BA,OAA7B,CAAqC,IAArC,EAA2C,GAA3C,CAAb;AACA,UAAIC,cAAcC,mBAAmBC,KAAKJ,MAAL,EAAaD,KAAb,CAAmB,EAAnB,EAAuBM,GAAvB,CAA2B,UAASC,CAAT,EAAY;AAC3E,cAAO,MAAM,CAAC,OAAOA,EAAEC,UAAF,CAAa,CAAb,EAAgBC,QAAhB,CAAyB,EAAzB,CAAR,EAAsCC,KAAtC,CAA4C,CAAC,CAA7C,CAAb;AACA,OAFoC,EAElCC,IAFkC,CAE7B,EAF6B,CAAnB,CAAlB;;AAIA,aAAOC,KAAKC,KAAL,CAAWV,WAAX,CAAP;AACA;;;2BAEKW,M,EAAOC,M,EAAO;AAAA;;AACnB;AACA;AACA;AACA;AACA,WAAKlB,QAAL,CAAcmB,IAAd,CAAmB,aAAnB,EAAkC;AACjCC,eAAS,MADwB;AAEjCC,aAAMN,KAAKO,SAAL,CAAe;AACpB,iBAAUL,MADU;AAEpB,oBAAaC;AAFO,QAAf,CAF2B;AAMjCK,gBAAS;AACP,wBAAgB;AAChB;AAFO;AANwB,OAAlC,EAWCC,IAXD,CAWM;AAAA,cAAOC,IAAIF,OAAJ,CAAYG,GAAZ,CAAgB,gBAAhB,CAAP;AAAA,OAXN,EAYCF,IAZD,CAYM,iBAAS;AACdG,eAAQC,GAAR,CAAY,OAAZ,EAAqB3B,KAArB;AACA,WAAGA,KAAH,EAAS;AACR4B,eAAOC,cAAP,CAAsB7B,KAAtB,GAA8BA,KAA9B;AACA4B,eAAOC,cAAP,CAAsBb,KAAtB,GAA8B,MAAKc,SAAL,CAAe9B,KAAf,EAAsBgB,KAApD;AACA;AACD,OAlBD,EAmBCO,IAnBD,CAmBM,eAAO;AACZ,WAAG,KAAK,CAAR,EAAU;AACTK,eAAOG,QAAP,CAAgBC,IAAhB,GAAuB,YAAvB;AACA;AACD,OAvBD,EAwBCC,KAxBD,CAwBO;AAAA,cAAOP,QAAQC,GAAR,CAAYO,GAAZ,CAAP;AAAA,OAxBP;AAyBA;AACA;;;8BAEO;AACP;AACA;;;8BAEO;AACP;AACA;AACA;AACA;AACA;;;;;;AAGEtC,kB,GAAkB,IAAIE,eAAJ,E","file":"LoginController.js","sourcesContent":["import {HttpService} from '../services/HttpService';\n\nclass LoginController{\n\t\n\tconstructor(){\n\t\tthis._service = new HttpService();\n\t}\n\n\t_parseJwt (token) {\n\t\tvar base64Url = token.split('.')[1];\n\t\tvar base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n\t\tvar jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n\t\t\treturn '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n\t\t}).join(''));\n\t\n\t\treturn JSON.parse(jsonPayload);\n\t};\n\n\tlogin(login, passwd){\n\t\t// Realiza a submisão de login\n\t\t// Ao receber a resposta favoravel de login:\n\t\t// \t\tGrava o resultado do x-access-token na sessão do usuário\n\t\t// \t\tRedireciona para o index\n\t\tthis._service.post('/autenticar', {\n\t\t\tmethod : 'POST',\n\t\t\tbody: JSON.stringify({\n\t\t\t\t'login' : login,\n\t\t\t\t'password' : passwd\n\t\t\t}),\n\t\t\theaders: {\n\t\t\t  'Content-Type': 'application/json'\n\t\t\t  // 'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t})\n\t\t.then(res => res.headers.get('x-access-token'))\n\t\t.then(token => {\n\t\t\tconsole.log('token', token);\n\t\t\tif(token){\n\t\t\t\twindow.sessionStorage.token = token;\n\t\t\t\twindow.sessionStorage.login = this._parseJwt(token).login;\n\t\t\t}\n\t\t})\n\t\t.then(res => {\n\t\t\tif(1 == 1){\n\t\t\t\twindow.location.href = \"index.html\";\n\t\t\t}\n\t\t})\n\t\t.catch(err => console.log(err));\n\t\t// redir home (login / sign in)\n\t}\n\n\tlogout(){\n\t\t// Apaga o resultado do x-access-token na sessão do usuário\n\t}\n\n\tsignin(){\n\t\t// Faz validações\n\t\t// \t\tSe validações ok:\n\t\t// \t\tSubmete dados para cadastro do usuário\n\t\t//\t\tSe cadastro ok redireciona para tela de login\n\t}\n}\n\nlet loginController = new LoginController();\n\nexport function loginControllerInstance(){\n    return loginController;\n}"]}