{"version":3,"sources":["../../app-es6/controllers/ActivityController.js"],"names":["activityControllerInstance","activityController","Bind","DateHelper","MultiBind","Activity","Message","User","UserService","ActivitiesView","ActivitiesDashboardView","MessageView","NavigationBarView","BadgesView","CollectiblesView","TransactionsView","PurchaseModalView","Collectible","$","document","querySelector","bind","ActivityController","_service","name","balance","_date","_activity","_place","_route_distance","_time","_purchaseCollectible","getUserInfo","then","user_obj","_user","_newUserModel","_message","_init","import","event","preventDefault","activity","_createActivity","console","log","addActivity","res","text","catch","error","_cleanForm","getUserActivities","activities","forEach","getUserBadges","badges","addBadge","badge","getUserCollectibles","collectibles","addCollectible","collectible","getUserTransactions","transactions","addTransaction","transaction","textToDate","value","parseFloat","Date","_id","target","id","toogle","dataset","parentElement","innerText","Array","from","children","el","classList","toggle","elem","items","icon","src","hist","price","serie","style","display","addEventListener","remove","purchaseCollectible","resp","add"],"mappings":"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","file":"ActivityController.js","sourcesContent":["import {Bind} from '../helpers/Bind';\r\nimport { DateHelper } from '../helpers/DateHelper';\r\nimport {MultiBind} from '../helpers/MultiBind';\r\n\r\nimport {Activity} from '../models/Activity';\r\nimport {Message} from '../models/Message';\r\nimport {User} from '../models/User';\r\n\r\nimport {UserService} from '../services/UserService';\r\n\r\nimport {ActivitiesView} from '../views/ActivitiesView';\r\nimport {ActivitiesDashboardView} from '../views/ActivitiesDashboardView';\r\nimport {MessageView} from '../views/MessageView';\r\nimport { NavigationBarView } from '../views/NavigationBarView';\r\nimport { BadgesView } from '../views/BadgesView';\r\nimport { CollectiblesView } from '../views/CollectiblesView';\r\nimport { TransactionsView } from '../views/TransactionsView';\r\nimport { PurchaseModalView } from '../views/PurchaseModalView';\r\nimport { Collectible } from '../models/Collectible';\r\n\r\nlet $ = document.querySelector.bind(document);\r\n\r\nclass ActivityController {\r\n\r\n    constructor(){\r\n        this._service = new UserService();\r\n\r\n        let name = null;\r\n        let balance = null;\r\n\r\n        this._date = $(\"#date\");\r\n        this._activity = $(\"#activity\");\r\n        this._place = $(\"#place\");\r\n        this._route_distance = $(\"#route_distance\");\r\n        this._time = $(\"#time\");\r\n\r\n        // this._targetCollectible = new Collectible();\r\n        this._purchaseCollectible = new Bind(Collectible, new PurchaseModalView($(\"#purchase-modal\")));\r\n\r\n        this._service\r\n            .getUserInfo()\r\n            .then(user_obj => {\r\n                name = user_obj.name;\r\n                balance = user_obj.balance;\r\n            })\r\n            .then(() => {\r\n\r\n                this._user = this._newUserModel(name, balance);\r\n                this._message = new Bind(new Message(), new MessageView($(\"#messaging\")), 'text');\r\n                this._init();\r\n\r\n            });\r\n    }\r\n\r\n    _newUserModel(name, balance){\r\n        return new MultiBind(new User(name, balance), [\r\n            new ActivitiesView($(\"#activities-data\")), \r\n            new ActivitiesDashboardView($(\"#management-dashboard\")),\r\n            new BadgesView($(\"#badges\")),\r\n            new CollectiblesView($(\"#collectibles\")),\r\n            new TransactionsView($(\"#extract\")),\r\n            new NavigationBarView($(\".user-pill\"))\r\n        ], 'addActivity', 'addBadge', 'addCollectible', 'addTransaction');\r\n    }\r\n\r\n    _init(){\r\n        this.import();\r\n                //this._test();\r\n    }\r\n\r\n    add(event){\r\n        event.preventDefault();\r\n\r\n        const activity = this._createActivity();\r\n        console.log(\"ADD Activity\");\r\n        this._service\r\n            .addActivity(activity)\r\n            .then(res => {\r\n                console.log(res);\r\n                this._message.text = \"Activity created\";\r\n            })\r\n            .catch(error => this._message.text = error);\r\n\r\n        this._user.addActivity(activity);\r\n\r\n        this._cleanForm();\r\n    }\r\n\r\n    import() {\r\n        this._service\r\n            .getUserActivities()\r\n            .then(activities => {\r\n                activities.forEach(activity => this._user.addActivity(activity));\r\n            })\r\n            .catch(error => this._message.text = error);\r\n\r\n        this._service\r\n            .getUserBadges()\r\n            .then(badges => {\r\n                return badges;\r\n            })\r\n            .then(badges => {\r\n                badges.forEach(badge => this._user.addBadge(badge));\r\n            })\r\n            .catch(error => this._message.text = error);\r\n\r\n\r\n        this._service\r\n            .getUserCollectibles()\r\n            .then(collectibles => {\r\n                collectibles.forEach(collectible => this._user.addCollectible(collectible));\r\n            })\r\n            .catch(error => this._message.text = error);\r\n\r\n            this._service\r\n                .getUserTransactions()\r\n                .then(transactions => {\r\n                    transactions.forEach(transaction => this._user.addTransaction(transaction));\r\n                })\r\n                .catch(error => this._message.text = error);\r\n\r\n\r\n    }\r\n\r\n    _createActivity(){\r\n        return new Activity(\r\n            DateHelper.textToDate(this._date.value),\r\n            this._activity.value,\r\n            this._place.value,\r\n            parseFloat(this._route_distance.value),\r\n            this._time.value\r\n        );\r\n    }\r\n\r\n    _cleanForm(){\r\n        this._date = new Date();\r\n        this._activity = \"Walking\";\r\n        this._place = \"\";\r\n        this._route_distance = 0.00;\r\n        this._time = \"00:00:00\";\r\n        //this._date.focus();\r\n    }\r\n\r\n    toogle_section(event){\r\n        let _id = event.target.id;\r\n        let toogle = $(`#${_id}`).dataset.toogle;\r\n        let target = $(`#${_id}`).parentElement.querySelector(\"section\");\r\n        \r\n        if(toogle == \"true\"){\r\n            $(`#${_id}`).innerText = \"[Show Section]\";\r\n            $(`#${_id}`).dataset.toogle = \"false\";\r\n        }\r\n        else{\r\n            $(`#${_id}`).innerText = \"[Hide Section]\";\r\n            $(`#${_id}`).dataset.toogle = \"true\";\r\n        }\r\n\r\n        Array.from(target.children).forEach(el => {console.log(el)});\r\n        Array.from(target.children).forEach(el => el.classList.toggle(\"invisible\"));\r\n\r\n    }\r\n\r\n    buyCollectible(elem){\r\n        // open modal, option to confirm checkout, purchase order\r\n        console.log(elem);\r\n\r\n        let items = Array.from(elem.children);\r\n        let icon = items[0].src;\r\n        let hist = items[1].innerText;\r\n\r\n        new this._purchaseCollectible(elem.id, \"Title\", icon, elem.dataset.price, elem.dataset.serie, hist, false, \"desc\");\r\n        $(\"#parent-purchase-modal\").style.display = \"block\";\r\n\r\n        $('.modal-close').addEventListener('click', () => $(\"#parent-purchase-modal\").style.display = \"none\" );\r\n        $('#dismiss-modal').addEventListener('click', () => $(\"#parent-purchase-modal\").style.display = \"none\" );\r\n\r\n        $('#purchase-modal-form').addEventListener('submit', (event) => {\r\n            event.preventDefault();\r\n\r\n            $(\".oper-gif img\").classList.remove('disp-n');\r\n            this._service\r\n                .purchaseCollectible(elem.id)\r\n                .then((resp) => {\r\n                    $(\".oper-gif img\").src = './imgs/misc/ok.gif';\r\n                    $(\".modal-content\").classList.remove('error');\r\n                    $(\".modal-content\").classList.add('success');\r\n                    console.log(\"RESP on AcCntrl\", resp);\r\n                })\r\n                .catch((resp) => {\r\n                    $(\".oper-gif img\").src = './imgs/misc/nok.gif';\r\n                    $(\".modal-content\").classList.remove('success');\r\n                    $(\".modal-content\").classList.add('error');\r\n                    console.log(\"RESP on AcCntrl\", resp);\r\n                });\r\n        });\r\n\r\n    }\r\n\r\n    _closeModal(){\r\n        $(\"#parent-purchase-modal\").style.display = \"none\";\r\n    }\r\n\r\n}\r\n\r\nlet activityController = new ActivityController();\r\n\r\nexport function activityControllerInstance(){\r\n    return activityController;\r\n}"]}